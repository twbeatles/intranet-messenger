<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔒 사내 메신저 (E2E 암호화)</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="/static/js/socket.io.min.js"></script>
    <script src="/static/js/crypto-js.min.js"></script>
</head>
<body>
    <!-- 인증 화면 -->
    <div id="authContainer" class="auth-container">
        <div class="auth-box">
            <h1>🔒 사내 메신저</h1>
            <p class="subtitle">종단간 암호화로 안전하게 소통하세요</p>
            <div style="text-align:center;"><span class="encryption-badge">🔒 E2E 암호화 적용</span></div>
            <div id="authError" class="error-message hidden"></div>
            
            <!-- 로그인 폼 -->
            <form id="loginForm" onsubmit="return false;">
                <div class="form-group">
                    <label>아이디</label>
                    <input type="text" id="loginUsername" placeholder="아이디를 입력하세요" required>
                </div>
                <div class="form-group">
                    <label>비밀번호</label>
                    <input type="password" id="loginPassword" placeholder="비밀번호를 입력하세요" required>
                </div>
                <button type="button" class="btn btn-primary" id="loginBtn">로그인</button>
            </form>
            
            <!-- 회원가입 폼 -->
            <form id="registerForm" class="hidden" onsubmit="return false;">
                <div class="form-group">
                    <label>아이디</label>
                    <input type="text" id="regUsername" placeholder="3자 이상" required>
                </div>
                <div class="form-group">
                    <label>비밀번호</label>
                    <input type="password" id="regPassword" placeholder="4자 이상" required>
                </div>
                <div class="form-group">
                    <label>닉네임</label>
                    <input type="text" id="regNickname" placeholder="표시될 이름">
                </div>
                <button type="button" class="btn btn-primary" id="registerBtn">회원가입</button>
            </form>
            
            <div class="auth-switch">
                <span id="switchToRegisterWrap">계정이 없으신가요? <a href="javascript:void(0)" id="showRegister">회원가입</a></span>
                <span id="switchToLoginWrap" style="display:none">이미 계정이 있으신가요? <a href="javascript:void(0)" id="showLogin">로그인</a></span>
            </div>
        </div>
    </div>
    
    <!-- 메인 앱 -->
    <div id="appContainer" class="app-container">
        <!-- 사이드바 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>🔒 대화</h2>
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <input type="text" id="searchInput" placeholder="대화 검색...">
                </div>
            </div>
            <div class="room-list" id="roomList"></div>
            <div class="online-section" id="onlineSection">
                <h4><span class="dot"></span> 온라인 사용자</h4>
                <div class="online-users-list" id="onlineUsersList"></div>
            </div>
            <div class="user-section">
                <div class="user-avatar" id="userAvatar"></div>
                <div class="user-info">
                    <div class="user-name" id="userName"></div>
                    <div class="user-status">온라인</div>
                </div>
                <div class="user-actions">
                    <button class="icon-btn" id="newChatBtn" title="새 대화">➕</button>
                    <button class="icon-btn" id="logoutBtn" title="로그아웃">🚪</button>
                </div>
            </div>
        </div>
        
        <!-- 채팅 영역 -->
        <div class="chat-area" id="chatArea">
            <div class="empty-state" id="emptyState">
                <span class="empty-icon">💬</span>
                <h3>대화를 선택하세요</h3>
                <p>왼쪽에서 대화를 선택하거나 새 대화를 시작하세요</p>
            </div>
            
            <div id="chatContent" class="chat-content hidden">
                <div class="chat-header">
                    <button class="icon-btn mobile-menu-btn" id="mobileMenuBtn">☰</button>
                    <div class="chat-header-info">
                        <div class="chat-header-avatar" id="chatAvatar"></div>
                        <div>
                            <div class="chat-header-name" id="chatName">🔒</div>
                            <div class="chat-header-status" id="chatStatus"></div>
                        </div>
                    </div>
                    <div class="chat-header-actions">
                        <button class="icon-btn" id="roomSettingsBtn" title="설정">⚙</button>
                        <div class="dropdown-menu" id="roomSettingsMenu">
                            <div class="dropdown-item" id="editRoomNameBtn">✏ 대화방 이름 변경</div>
                            <div class="dropdown-item" id="pinRoomBtn">📌 <span id="pinRoomText">상단 고정</span></div>
                            <div class="dropdown-item" id="muteRoomBtn">🔕 <span id="muteRoomText">알림 끄기</span></div>
                            <div class="dropdown-item" id="viewMembersBtn">👥 멤버 보기</div>
                        </div>
                        <button class="icon-btn" id="inviteBtn" title="초대">👤➕</button>
                        <button class="icon-btn" id="leaveRoomBtn" title="나가기">🚪</button>
                    </div>
                </div>
                <div class="messages-container" id="messagesContainer"></div>
                <div class="typing-indicator hidden" id="typingIndicator"></div>
                <div class="chat-input-container">
                    <div class="encryption-notice">🔒 메시지는 종단간 암호화됩니다</div>
                    <div class="chat-input-wrapper">
                        <div class="chat-input-actions">
                            <button class="icon-btn" id="emojiBtn">😊</button>
                            <button class="icon-btn" id="attachBtn">📎</button>
                            <input type="file" id="fileInput" style="display:none;">
                            <div class="emoji-picker" id="emojiPicker"></div>
                        </div>
                        <textarea class="chat-input" id="messageInput" placeholder="메시지를 입력하세요..." rows="1"></textarea>
                        <button class="send-btn" id="sendBtn">✉</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 새 대화 모달 -->
    <div class="modal-overlay" id="newChatModal">
        <div class="modal">
            <div class="modal-header">
                <h3>새 대화 시작</h3>
                <button class="modal-close" id="closeNewChatModal">✕</button>
            </div>
            <div class="form-group">
                <label>대화방 이름 (그룹 채팅 시)</label>
                <input type="text" id="roomName" placeholder="대화방 이름">
            </div>
            <div class="form-group"><label>참여자 선택</label></div>
            <div class="user-list" id="userList"></div>
            <button class="btn btn-primary" id="createRoomBtn" style="margin-top:16px;">대화 시작</button>
        </div>
    </div>
    
    <!-- 초대 모달 -->
    <div class="modal-overlay" id="inviteModal">
        <div class="modal">
            <div class="modal-header">
                <h3>멤버 초대</h3>
                <button class="modal-close" id="closeInviteModal">✕</button>
            </div>
            <div class="user-list" id="inviteUserList"></div>
            <button class="btn btn-primary" id="confirmInviteBtn" style="margin-top:16px;">초대하기</button>
        </div>
    </div>
    
    <!-- 연결 상태 표시 -->
    <div class="connection-status" id="connectionStatus">
        <span class="status-dot"></span>
        <span class="status-text">연결 중...</span>
    </div>
    
    <script src="/static/js/storage.js"></script>
    <script src="/static/js/notification.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
