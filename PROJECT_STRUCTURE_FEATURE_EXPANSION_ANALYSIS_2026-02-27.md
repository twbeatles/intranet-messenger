# Intranet Messenger ?꾨줈?앺듃 援ъ“ ?뺣? 遺꾩꽍 諛?湲곕뒫 ?뺤옣 媛?대뱶

- ?묒꽦?? 2026-02-27
- ???寃쎈줈: `C:\twbeatles-repos\intranet-messenger`
- 紐⑹쟻: ?꾩옱 援ъ“瑜?湲곗??쇰줈 湲곕뒫 ?뺤옣 ???섏젙 吏?? 由ъ뒪?? ?곗꽑?쒖쐞瑜?紐낇솗???뺤쓽

## 1. 李몄“ 臾몄꽌

- `README.md`
- `claude.md`
- `gemini.md`
- `docs/BACKUP_RUNBOOK.md`

## 2. ?꾩옱 湲곗???
- ?뚯뒪??湲곗??? `pytest -q` -> `84 passed` (2026-02-27)
- ?ㅽ뻾 吏꾩엯?? `server.py`
- ?덇굅???명솚 吏꾩엯?? `messenger_server.py` (deprecated shim)

## 3. ?꾨줈?앺듃 理쒖긽??援ъ“

- `server.py`: CLI/GUI ?ㅽ뻾 吏꾩엯
- `config.py`: ?고????ㅼ젙 諛?湲곕뒫 ?뚮옒洹?- `app/`: 諛깆뿏???듭떖(???⑺넗由? routes, sockets, models)
- `static/`, `templates/`: ?꾨줎?몄뿏??由ъ냼??諛??⑥씪 ?섏씠吏 ?쒗뵆由?- `tests/`: ?뚭? ?뚯뒪??- `scripts/`: 諛깆뾽/蹂듦뎄/寃利??ㅽ겕由쏀듃
- `docs/`: ?댁쁺 臾몄꽌
- `messenger.spec`: PyInstaller 鍮뚮뱶 紐낆꽭

## 4. 二쇱슂 ?ㅽ뻾/援ъ꽦 ?먮쫫

1. `server.py` ?ㅽ뻾
2. `app.create_app()`?먯꽌 ?뺤옣 珥덇린??Session/Socket/RateLimit ??
3. `app/routes.py` HTTP ?쇱슦???깅줉
4. `app/sockets.py` ?뚯폆 ?대깽???깅줉
5. `app/models/base.py` 湲곕컲 DB 珥덇린???좎?蹂댁닔

## 5. 援ъ“ 由ъ뒪??湲곗닠遺梨?
### 5.1 肄붾뱶 寃쎈줈 ?댁쨷??
- 怨쇨굅?먮뒗 `messenger_server.py`? `app/*`媛 蹂묓뻾?섏뼱 湲곗? 寃쎈줈 ?쇱꽑 ?꾪뿕??議댁옱
- ?꾩옱??`server.py` 湲곗??쇰줈 ?⑥씪?뷀븯怨?`messenger_server.py`??shim?쇰줈 異뺤냼

### 5.2 ?꾨줎?몄뿏??寃고빀??
- `messages.js`/`rooms.js`??梨낆엫 吏묒쨷???ш퀬 蹂寃??곹뼢 踰붿쐞媛 ?볦쓬
- ?낅줈??濡쒖쭅? `static/js/message-upload.js`濡?1李?遺꾨━ ?꾨즺

### 5.3 臾몄옄???몄퐫???붾뱾由?
- 肄섏넄/濡쒓렇 ?몄퐫???섍꼍???곕씪 源⑥쭚 媛?μ꽦??議댁옱
- ?쒕쾭 吏꾩엯?먯뿉 UTF-8 stdio ?ㅼ젙???곸슜???꾪솕

### 5.4 ?뚯뒪??寃쎄퀬 ?꾩쟻

- Flask-Session deprecation 寃쎄퀬媛 ?꾩쟻???ъ?媛 ?덉뿀??- `cachelib` 諛깆뿏???꾪솚?쇰줈 寃쎄퀬 由ъ뒪?щ? ?꾪솕

## 6. 2026-02-27 媛쒖꽑 諛섏쁺 ?붿빟

- `messenger_server.py` deprecated shim ?꾪솚
- `static/js/message-upload.js` 異붽? 諛?`messages.js` ?꾩엫 援ъ“ ?곸슜
- `server.py`, `app/server_launcher.py`, `app/run_server.py` UTF-8 stdio 怨좎젙
- `app/sockets.py` ?ㅻ쪟 硫붿떆吏 紐⑥?諛붿? ?뺢퇋??寃쎈줈 異붽?
- `app/__init__.py` ?몄뀡 ??μ냼 `cachelib` ?꾪솚
- `requirements.txt`??`cachelib>=0.13.0` 異붽?

## 7. 湲곕뒫 ?뺤옣 ?곗꽑?쒖쐞 ?쒖븞

- P1: ?뚮┝ ?쇳꽣(誘몄씫??硫섏뀡), 硫붿떆吏 ?섏젙 ?대젰, 蹂댁〈 ?뺤콉 UI
- P2: ?ㅻ젅???듦?, ?덉빟 硫붿떆吏, 愿由ъ옄 ??쒕낫??- P3: 怨좉툒 寃???뺤옣, ?뚯씪 DLP ?쇰꺼, ?꾨줎??紐⑤뱢 ?꾪솚

## 8. ?묒뾽 ?먯튃

1. API 怨꾩빟 蹂寃???`routes + static/js + tests + README`瑜?媛숈? 蹂寃??명듃濡?媛깆떊
2. ?뚯씪 硫붿떆吏????긽 `upload_token` 寃利?寃쎈줈 ?좎?
3. ?몄뀡 臾댄슚??寃利앹? HTTP/Socket 紐⑤몢 ?좎?
4. 蹂寃???理쒖냼 `pytest -q` ?ㅽ뻾 寃곌낵瑜?湲곕줉



## 9. 2026-02-28 리스크 반영 후 구조 관찰

- API/Socket 계약 경계가 명확해졌음.
  - HTTP pin create/delete가 시스템 메시지 생성의 단일 경로가 됨.
  - 소켓 `pin_updated`는 동기화 신호 역할만 수행.
- 소켓 payload 신뢰 모델이 `client-provided data`에서 `server DB canonical`로 전환됨.
- OIDC 인증 실패면 즉시 로그인 거부하는 strict 정책으로 보안 경계가 강화됨.
- 고급검색/leave/uploaded_file 경계 조건이 표준 에러 계약으로 정리됨.

### 후속 권장

1. Socket event schema를 별도 문서(`docs/socket-events.md`)로 분리해 프론트/백엔드 공용 계약화.
2. OIDC/JWKS 관련 운영 파라미터(`OIDC_JWKS_URL`, cache TTL)의 환경별 설정 표준화.
3. PyInstaller 산출물 smoke test를 CI 단계에 추가.
